sap.ui.define(["sap/ui/core/mvc/ControllerExtension","sap/ui/core/Control","sap/ui/core/format/DateFormat"],function(t,e,n){"use strict";function r(){debugger;const t=["loanoffercreation::ContractObjectPage--fe::Form::_1::Content","loanoffercreation::ContractObjectPage--fe::Form::TermFixedPeriod::Content"];t.forEach(function(t){const e=sap.ui.getCore().byId(t);if(!e||!e.getLayout)return;const n=e.getLayout();if(!n)return;n.setColumnsXL(3);n.setColumnsL(3);n.setColumnsM(3);if(n.setMaxColumns){n.setMaxColumns(3)}if(n.setAdjustLabelSpan){n.setAdjustLabelSpan(false)}})}function o(){const t={earmark:{id:"loanoffercreation::ContractObjectPage--fe::table::contractToEarmark::LineItem::_-innerTable",widths:["6rem","15rem","4rem","8rem","8rem","5rem","7rem","8rem","8rem"],forceFixed:true},condition:{id:"loanoffercreation::ContractObjectPage--fe::table::contractToCondition::LineItem::ConditionItems-innerTable",widths:["12rem","9rem","6rem","8rem","9rem","9rem","9rem","9rem","8rem","12rem","12rem","12rem"],forceFixed:true}};Object.values(t).forEach(t=>{const e=sap.ui.getCore().byId(t.id);if(!e||!e.getColumns)return;e.setWidth("100%");if(t.forceFixed){const t=e.getDomRef();if(t)t.style.tableLayout="fixed"}const n=e.getColumns().filter(t=>t.getId().includes("::C::"));n.forEach((e,n)=>{if(t.widths[n]){e.setWidth(t.widths[n])}})})}function a(){const t=sap.ui.getCore().byId("loanoffercreation::ContractObjectPage--fe::table::contractToEarmark::LineItem::_-innerTable");if(!t)return;const e=t.getBinding("rows");if(!e)return;e.sort([new sap.ui.model.Sorter("documentNumber",false)])}function i(t){if(!t)return;var e=t.getBinding("items");if(!e)return;var n=new sap.ui.model.Sorter("title",true,function(t){var e=t.getProperty("title");if(e==="Main Loan Partner")return"1";if(e==="Loan Partner")return"2";return"3"});e.sort(n)}return t.extend("loanoffercreation.ext.controller.Contractobj",{override:{onInit:function(){this._setupDateObserver()},onAfterRendering:function(){},routing:{onAfterBinding:function(){this._formatEditDates();this._formatDisplayDates();debugger;setTimeout(r,600);setTimeout(o,500);setTimeout(()=>{a()},300);setTimeout(()=>{i(this.base.getView().byId("loanoffercreation::ContractObjectPage--fe::HeaderFacetCustomContainer::Header--partnersVBox"))},400);const t=["loanoffercreation::ContractObjectPage--fe::table::contractToPartner::LineItem::Partners-innerTable","loanoffercreation::ContractObjectPage--fe::table::contractToCondition::LineItem::ConditionItems-innerTable","loanoffercreation::ContractObjectPage--fe::table::contractToDisbursement::LineItem::Disbursements-innerTable"];function e(){t.forEach(function(t){const r=sap.ui.core.Element.getElementById(t);console.log(t,r?r.getMetadata().getName():"Table not found");if(!r){setTimeout(e,500);return}if(!r._dateFormattingAttached){if(r.attachRowsUpdated){r.attachRowsUpdated(function(){n(r)})}r._dateFormattingAttached=true}n(r)})}function n(t){if(!t)return;if(t.getRows){const e=t.getRows();if(!e||e.length===0)return;const n=t.getId();e.forEach(function(t){const e=t.getCells();if(!e)return;if(n.includes("contractToPartner")){s(e[5],"startRel");s(e[6],"endRel")}if(n.includes("contractToCondition")){s(e[1],"effectiveFrom");s(e[6],"dueDate");s(e[7],"calculationDate")}if(n.includes("contractToDisbursement")){s(e[2],"paymentDate");s(e[3],"effectiveDate")}})}}function s(t,e){if(!t)return;const n=t?.mAggregations?.content?.mAggregations?.contentEdit?.[0];if(n&&n.setDisplayFormat){n.unbindProperty("value");n.bindProperty("dateValue",{path:e});n.setDisplayFormat("MM/dd/yyyy");n.setValueFormat("yyyy/MM/dd")}const r=t?.mAggregations?.content?.mAggregations?.contentDisplay;if(r&&r.setText){let t=r.getText();if(!t){const e=r.getBinding("text");if(e){t=e.getValue()}}if(t){const e=new Date(t);if(!isNaN(e.getTime())){const t=String(e.getDate()).padStart(2,"0");const n=String(e.getMonth()+1).padStart(2,"0");const o=e.getFullYear();r.setText(`${n}/${t}/${o}`)}else{r.setText("")}}else{r.setText("")}}}e()}}},_formatEditDates:function(){const t=this.base.getView();if(!t)return;this._walkControls(t,t=>{if(t.isA&&t.isA("sap.m.DatePicker")){const e=t.getBinding("value");if(e){const n=e.getPath();t.unbindProperty("value");t.bindProperty("dateValue",{path:n})}t.setDisplayFormat("MM/dd/yyyy");t.setValueFormat("yyyy-MM-dd")}})},_formatDisplayDates:function(){const t=n.getDateInstance({pattern:"MM/dd/yyyy"});document.querySelectorAll("[id$='Field-display'], .sapMText").forEach(e=>{const n=e.innerText?.trim();if(!n)return;if(/^\d{2}\/\d{2}\/\d{4}$/.test(n))return;const r=n.match(/^([A-Za-z]{3}) (\d{1,2}), (\d{4})$/);if(!r)return;const o=new Date(`${r[1]} ${r[2]}, ${r[3]}`);if(isNaN(o))return;e.innerText=t.format(o)})},_setupDateObserver:function(){const t=new MutationObserver(()=>{this._formatDisplayDates()});t.observe(document.body,{childList:true,subtree:true})},_walkControls:function(t,n){n(t);if(!t.getAggregation)return;const r=t.getMetadata().getAllAggregations();Object.keys(r).forEach(r=>{const o=t.getAggregation(r);if(Array.isArray(o)){o.forEach(t=>this._walkControls(t,n))}else if(o instanceof e){this._walkControls(o,n)}})}})});
//# sourceMappingURL=Contractobj.controller.js.map